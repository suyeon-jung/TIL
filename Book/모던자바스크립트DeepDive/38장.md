# 38장. 브라우저의 렌더링 과정

- 웹애플리케이션의 클라이언트 사이드 자바스크립트는 브라우저에서 HTML, CSS와 함께 실행된다.
- 브라우저가 HTML, CSS, 자바스크립트로 작성된 텍스트 문서를 어떻게 파싱(해석)하여 브라우저에 렌더링하는지에 대해 학습한다.

> **파싱(parsing)**
프로그래밍 언어의 문법에 맞게 작성된 텍스트 문서를 읽어 들여 실행하기 위해 텍스트 문서의 문자열을 *토큰으로 분해*하고 *토큰에 문법적 의미와 구조를 반영*하여 트리 구조의 자료구조인 *파스 트리를 생성*하는 일련의 과정을 말한다.
> 

> **렌더링(redering)**
HTML, CSS, 자바스크립트로 작성된 문서를 파싱하여 브라우저에 시각적으로 출력하는 것
> 

- **브라우저의 렌더링 과정**
1. 브라우저는 **HTML, CSS, 자바스크립트, 이미지, 폰트 파일 등 렌더링에 필요한 리소스를 요청**하고 서버로부터 응답을 받는다.
2. 브라우저의 `렌더링 엔진`은 서버로부터 응답된 **HTML과 CSS를 파싱**하여 **DOM과 CSSOM을 생성**하고 이들을 결합해 **렌더 트리를 생성**한다. 
3. 브라우저의 `자바스크립트 엔진`은 서버로부터 응답된 **자바스크립트를 파싱**하여 AST(Abstract Syntax Tree)를 생성하고 **바이트코드로 변환하여 실행**한다. 이때 자바스크립트는 DOM API를 통해 DOM이나 CSSOM을 변경할 수 있다. 변경된 DOM과 CSSOM은 다시 렌더 트리로 결합된다. 
4. 렌더 트리를 기반으로 **HTML 요소의 레이아웃(위치와 크기)을 계산**하고 **브라우저 화면에 HTML 요소를 페인팅**한다. 

<br>

## 38.1 요청과 응답

- **브라우저의 핵심 기능**
    
    필요한 리소스를 서버에 요청(request)하고 서버로부터 응답(response)받아 브라우저에 시각적으로 렌더링 하는 것
    
<br>

## 38.2 HTTP 1.1과 HTTP 2.0

> **HTTP?**
웹에서 브라우저와 서버가 통신하기 위한 프로토콜(규약)
> 

### HTTP/1.1

- 커넥션당 하나의 요청과 응답만 처리
    
    → 여러 개의 요청을 한 번에 전송할 수 없고 응답 또한 마찬가지
    
    → 요청할 리소스의 개수에 비례해 응답 시간 증가
    

### HTTP/2.0

- 다중 요청/응답이 가능
- HTTP/1.1에 비해 페이지 로드 속도가 약 50% 빠르다.

<br>

## 38.3 HTML 파싱과 DOM 생성

브라우저의 요청에 의해 서버가 응답한 HTML 문서는 문자열로 이루어진 순수한 텍스트로 **브라우저가 이해할 수 있는 자료구조(객체)로 변환할 필요가 있다.** 

- DOM 생성 흐름
    
    바이트 → 문자 → 토큰 → 노드 → DOM
    
- DOM
    
    HTML 문서를 파싱한 결과물
    
<br>

## 38.4 CSS 파싱과 CSSOM 생성

렌더링 엔진이 HTML을 처음부터 한줄 씩 순차적으로 파싱하여 DOM을 생성해나가다가 CSS를 로드하는 `link`태그나 `style` 태그를 만나면 DOM 생성을 일시 중단한다. 

- `link` 태그에 `href` 어트리뷰트에 지정된 CSS 파일을 서버에 요청
- CSS 파싱 완료 후 HTML 파싱이 중단된 지점부터 다시 HTML 파싱 시작
- CSSOM 생성 흐름
    
    바이트 → 문자 → 토큰 → 노드 → CSSOM
    
<br>

## 38.5 렌더 트리 생성

- DOM + CSSOM = 렌더 트리
- 렌더 트리 : 렌더링을 위한 트리 구조의 자료구조
- 완성된 렌더 트리는 **각 HTML 요소의 레이아웃(위치와 크기)을 계산**하는 데 사용되며 브라우저 화면에 픽셀을 렌더링하는 **페인팅 처리**에 입력된다.
- 리렌더링 발생하는 경우(레이아웃 계산, 페이틴 다시 실행)
    - 자바스크립트에 의한 노드 추가 또는 삭제
    - 브라우저 창의 리사이징에 의한 뷰포트 크기 변경
    - HTML 요소의 레이아웃(위치, 크기)에 변경을 발생시키는 스타일 변경(`width`, `height`, `margin`, `padding`, …)
    
    → 성능에 악영향
    
<br>

## 38.6 자바스크립트의 파싱과 실행

- DOM은 HTML 문서의 구조와 정보뿐만 아니라 HTML 요소와 스타일 등을 변경할 수 있는 프로그래밍 인터페이스인 `DOM API`를 제공한다.
- 자바스크립트 파싱과 실행은 브라우저의 `렌더링 엔진`이 아닌 `자바스크립트 엔진`이 처리한다.
- 자바스크립트 엔진
    - 자바스크립트 코드를 파싱하여 CPU가 이해할 수 있는 저수준 언어로 변환하고 실행하는 역할
    - 자바스크립트를 해석하여 AST(추상적 구문 트리)를 생성 → AST 기반으로 인터프리터가 실행할 수 있는 중간코드인 바이트코드를 생성하여 실행
    - 흐름
        
        자바스크립트 소스코드 → 토큰 → AST → 바이트 코드
        
    - 종류
        - 구글 크롬, Node.js의 V8
        - 파이어폭스의 SpiderMonkey
        - 사파리의 JavaScriptCore
        
- 토크나이징
    
    자바스크립트 소스코드를 어휘 분석하여 문법적 의미를 갖는 코드의 최소 단위인 토큰들로 분해
    
- 파싱
    
    토큰 집합을 구문 분석하여 AST를 생성
    
- 바이트코드 생성과 실행
    
    AST는 인터프리터가 실행할 수 있는 중간 코드인 바이트코드로 변환되고 인터프리터에 의해 실행
    
<br>

## 38.7 리플로우와 리페인트

- 자바스크립트 코드에서 DOM API가 사용된 경우 DOM이나 CSSOM이 변경된다.

→ 변경된 DOM과 CSSOM은 다시 렌더 트리로 결합되고 변경된 렌더 트리 기반으로 레이아웃과 페인트 과정을 거쳐 브라우저의 화면에 다시 렌더링

> **리플로우**
레이아웃 계산을 다시 하는 것
> 

> **리페인트**
재결합된 렌더 트리를 기반으로 다시 페인트하는 것
>